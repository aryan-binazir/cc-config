---
name: ticket_analysis
description: Analyze a ticket to find relevant files and assess necessity
argument-hint: "<ticket title and/or description>"
version: "1.0"
---

Analyze a new ticket to provide initial context and critical assessment. Uses sequential sub-agents for thorough research.

## Ticket Information

$ARGUMENTS

If `$ARGUMENTS` is empty, ask the user to provide the ticket title and/or description.

## Output Destination

Results are written to BOTH:
1. Screen (displayed to user)
2. `context/initial_review-{branch}.md` where `{branch}` comes from `git branch --show-current` (with `/` replaced by `-`)

## Workflow

### Phase 1: File Research

Spawn the `ticket-researcher` agent using the Task tool:

```
Task tool parameters:
- subagent_type: "Explore"
- model: "sonnet"

Prompt:
## Ticket

{ticket info from $ARGUMENTS}

Use the ticket-researcher agent behavior to identify relevant files and line numbers for this ticket.
```

Capture the full output from Phase 1.

### Phase 2: Need Analysis

Spawn the `ticket-assessor` agent using the Task tool:

```
Task tool parameters:
- subagent_type: "general-purpose"
- model: "sonnet"

Prompt:
## Ticket

{ticket info from $ARGUMENTS}

## Codebase Research Findings

{Phase 1 output}

Use the ticket-assessor agent behavior to critically evaluate this ticket's necessity and provide a recommendation.
```

Capture the full output from Phase 2.

### Phase 3: Compile & Output

Combine both phases into the final report.

**Report Structure**:

```markdown
# Initial Ticket Review

**Ticket**: {ticket title/description summary}
**Branch**: {current branch}
**Date**: {today's date}

---

## Part 1: Relevant Files & Locations

{Phase 1 output}

---

## Part 2: Necessity Analysis

{Phase 2 output}

---

## Reminder

Before implementing, review the codebase conventions (naming patterns, file structure, error handling, testing approach) and ensure your implementation aligns with existing patterns.

---

*Generated by `/ticket_analysis`*
```

**Output Actions**:

1. Display the full report to the user
2. Write the report to `context/initial_review-{branch}.md`:
   - Get branch: `git branch --show-current`
   - Replace `/` with `-` in branch name
   - Create `context/` directory if it doesn't exist
   - Write to `context/initial_review-{branch}.md`
3. Confirm: "Report saved to `context/initial_review-{branch}.md`"

## Agents Used

- **ticket-researcher**: Finds relevant files and line numbers within the ticket's domain
- **ticket-assessor**: Critically evaluates necessity and provides recommendation

## Notes

- Both agents use Sonnet model for cost-effective thorough analysis
- Phase 2 depends on Phase 1 findings, so they must run sequentially
- If either phase fails, report partial results and note what failed
